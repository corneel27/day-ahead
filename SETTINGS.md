# Day Ahead Optimizer - Configuration Settings

**Auto-generated from Pydantic models using JSON Schema**

üìã **Configuration Version:** `0`

> ‚ö†Ô∏è **Do not edit this file manually!**
> This documentation is auto-generated from Pydantic models.
> To update, modify the model docstrings and Field descriptions, then run:
> ```bash
> python -m dao.prog.config.generate_docs
> ```

## üìë Table of Contents

- [Quick Reference](#quick-reference)

- [Energy Storage](#energy-storage)
  - [üîã BatteryConfig](#batteryconfig)
- [Energy Production](#energy-production)
  - [‚òÄÔ∏è SolarConfig](#solarconfig)
- [Devices](#devices)
  - [üöó EVConfig](#evconfig)
  - [üß∫ MachineConfig](#machineconfig)
- [Heating & Climate](#heating-and-climate)
  - [üå°Ô∏è HeatingConfig](#heatingconfig)
  - [üíß BoilerConfig](#boilerconfig)
- [Infrastructure](#infrastructure)
  - [üíæ DatabaseConfig](#databaseconfig)
  - [‚ö° GridConfig](#gridconfig)
  - [‚è∞ HistoryConfig](#historyconfig)
- [Pricing & Markets](#pricing-and-markets)
  - [üí∞ PricingConfig](#pricingconfig)
- [Visualization](#visualization)
  - [üìà GraphicsConfig](#graphicsconfig)
- [Integration](#integration)
  - [üîî NotificationsConfig](#notificationsconfig)
  - [üìä DashboardConfig](#dashboardconfig)
  - [‚ö° TibberConfig](#tibberconfig)
  - [üè† HomeAssistantConfig](#homeassistantconfig)
- [Reporting](#reporting)
  - [üìâ ReportConfig](#reportconfig)
- [Automation](#automation)
  - [üïê SchedulerConfig](#schedulerconfig)
- [Other](#other)
  - [BatteryStage](#batterystage)
  - [EVChargeScheduler](#evchargescheduler)
  - [EVChargeStage](#evchargestage)
  - [FlexValue](#flexvalue)
  - [HADatabaseConfig](#hadatabaseconfig)
  - [HeatingStage](#heatingstage)
  - [MachineProgram](#machineprogram)
  - [SecretStr](#secretstr)
  - [SolarString](#solarstring)

---

## Quick Reference

### Legend

| Symbol | Meaning |
|--------|---------|
| üìñ | Field has detailed help text (expand for details) |
| üìö | External documentation available |

### Required vs Optional

| Value | Meaning |
|-------|---------|
| Yes | Required field - must be provided in configuration |
| No | Optional field |

### Default Values

| Value | Meaning |
|-------|---------|
| `‚Äî` | No default (required field) |
| `null` | Optional, defaults to null/none |
| `value` | Optional with this default value |

---

## Energy Storage

<a id="energy-storage"></a>

### üîã BatteryConfig

_Battery configuration for optimization._

# Battery Configuration

Configure your home battery storage system for optimal energy management and cost savings.

## Key Settings
- **Capacity**: Total storage capacity in kWh
- **SOC Limits**: Upper and lower charge limits to protect battery health
- **Power Stages**: Define charging/discharging efficiency curves
- **Control Entities**: Home Assistant entities to control the battery

## Tips
- Set upper_limit to 80-90% for longer battery life
- Configure charge/discharge stages for accurate optimization
- Monitor battery degradation with cycle_cost setting


üìö [**View detailed documentation ‚Üí**](https://github.com/corneel27/day-ahead/wiki/Battery-Configuration)

| Field | Type | Required | Default | Description |
|-------|------|----------|---------|-------------|
| `name` | string | Yes | ‚Äî | Battery name/identifier |
| `entity actual level` | string | Yes | ‚Äî | HA entity for current battery SOC (Unit: `%`) |
| `capacity` | number | Yes | ‚Äî | Battery capacity in kWh (Unit: `kWh`) _Must be greater than 0_ |
| `upper limit` | integer or [FlexValue](#flexvalue) | Yes | ‚Äî | Maximum SOC % (can be HA entity) (Unit: `%`) _0-100%, protects battery from overcharge_ |
| `lower limit` | integer or [FlexValue](#flexvalue) | Yes | ‚Äî | Minimum SOC % (can be HA entity) (Unit: `%`) _0-100%, protects battery from deep discharge_ |
| `optimal lower level` | integer or [FlexValue](#flexvalue) (optional) | No | `null` | Optimal lower SOC % for cost optimization (Unit: `%`) _Optional, should be >= lower_limit_ |
| `entity min soc end opt` | string (optional) | No | `null` | HA entity for minimum SOC at end of optimization period |
| `entity max soc end opt` | string (optional) | No | `null` | HA entity for maximum SOC at end of optimization period |
| `charge stages` | list[[BatteryStage](#batterystage)] | Yes | ‚Äî | Charge power/efficiency curve _At least 1 stage required, ordered by power_ |
| `discharge stages` | list[[BatteryStage](#batterystage)] | Yes | ‚Äî | Discharge power/efficiency curve _At least 1 stage required, ordered by power_ |
| `reduced hours` | object (optional) | No | `null` | Hour -> max power mapping for reduced power hours _Keys are hour strings (0-23), values are watts_ |
| `minimum power` | integer | Yes | ‚Äî | Minimum power in watts (Unit: `W`) _Must be >= 0, typically 50-200W_ |
| `dc_to_bat efficiency` | number | Yes | ‚Äî | DC to battery efficiency (Unit: `ratio`) _0.0-1.0, typically 0.95-0.98_ |
| `dc_to_bat max power` | number | Yes | ‚Äî | DC to battery max power in watts (Unit: `W`) _Must be > 0_ |
| `bat_to_dc efficiency` | number | Yes | ‚Äî | Battery to DC efficiency (Unit: `ratio`) _0.0-1.0, typically 0.95-0.98_ |
| `bat_to_dc max power` | number | Yes | ‚Äî | Battery to DC max power in watts (Unit: `W`) _Must be > 0_ |
| `cycle cost` | number | Yes | ‚Äî | Cost per battery cycle in euros (Unit: `‚Ç¨`) _Must be >= 0, typically ‚Ç¨0.50-‚Ç¨1.50 per cycle_ |
| `entity set power feedin` | string (optional) | No | `null` | HA entity to set power feed-in to grid |
| `entity set operating mode` | string (optional) | No | `null` | HA entity to set battery operating mode |
| `entity set operating mode on` | string (optional) | No | `null` | Value for operating mode ON |
| `entity set operating mode off` | string (optional) | No | `null` | Value for operating mode OFF |
| `entity stop inverter` | string (optional) | No | `null` | HA entity to stop inverter |
| `entity balance switch` | string (optional) | No | `null` | HA entity for grid balancing switch |
| `entity from battery` | string (optional) | No | `null` | HA entity for power from battery (Unit: `W`) |
| `entity from pv` | string (optional) | No | `null` | HA entity for power from PV (Unit: `W`) |
| `entity from ac` | string (optional) | No | `null` | HA entity for power from AC (Unit: `W`) |
| `entity calculated soc` | string (optional) | No | `null` | HA entity for calculated SOC (Unit: `%`) |
| `solar` | list[[SolarConfig](#solarconfig)] (optional) | No | `null` | DC-coupled solar panels attached to this battery |

<details>
<summary><b>üìñ Field Details</b> (click to expand)</summary>

**`name`**

Unique name to identify this battery in logs and reports. Use a descriptive name like 'Home Battery' or 'Garage Battery'.

**`entity actual level`**

Home Assistant entity that reports the current State of Charge (SOC) percentage. Usually a sensor from your battery inverter.

**`capacity`**

Total usable energy storage capacity of your battery. Check your battery specifications. For multiple batteries, sum their capacities.

**`upper limit`**

Maximum State of Charge in percent. Battery will never charge above this level. Supports FlexValue pattern: use integer or HA entity ID.

**`lower limit`**

Minimum State of Charge in percent. Battery will never discharge below this level. Supports FlexValue pattern: use integer or HA entity ID.

**`optimal lower level`**

Target SOC level for cost optimization. System will prefer this level over minimum. Supports FlexValue pattern.

**`entity min soc end opt`**

Optional: Home Assistant entity specifying minimum battery level required at end of optimization window. Useful for ensuring battery charge overnight.

**`entity max soc end opt`**

Optional: Home Assistant entity specifying maximum battery level at end of optimization window. Rarely needed but available for advanced scenarios.

**`charge stages`**

Power stages for charging with corresponding efficiencies. Defines charge curve from AC grid to battery. At least one stage required.

**`discharge stages`**

Power stages for discharging with corresponding efficiencies. Defines discharge curve from battery to AC grid. At least one stage required.

**`reduced hours`**

Optional: Restrict battery power during specific hours. Example: {'22': 1000, '23': 1000} limits to 1000W from 22:00-23:59. Useful for noise reduction at night.

**`minimum power`**

Minimum power threshold in watts. Operations below this power level will be rounded to zero. Prevents inefficient micro-charging/discharging.

**`dc_to_bat efficiency`**

Efficiency of DC-coupled solar to battery conversion. Typically 0.95-0.98 for modern DC-coupled systems. Only relevant if DC-coupled solar is configured.

**`dc_to_bat max power`**

Maximum power for DC-coupled solar charging in watts. Determines how much DC solar power can flow directly to battery.

**`bat_to_dc efficiency`**

Efficiency of battery to DC bus conversion. Typically 0.95-0.98. Only relevant for DC-coupled loads or reverse DC flow scenarios.

**`bat_to_dc max power`**

Maximum power for battery to DC bus conversion in watts. Rarely used in typical residential setups.

**`cycle cost`**

Degradation cost per full charge-discharge cycle in euros. Used to factor battery wear into optimization. Calculate as: (battery_cost / warranted_cycles). Example: ‚Ç¨5000 battery with 6000 cycles = ‚Ç¨0.83/cycle.

**`entity set power feedin`**

Optional: Home Assistant entity to control grid feed-in power. Used by scheduler to execute optimized battery operations.

**`entity set operating mode`**

Optional: Home Assistant entity to control battery operating mode (e.g., auto/manual/off). System will switch modes as needed for optimization.

**`entity set operating mode on`**

Value to send to operating mode entity for 'ON' state. Example: 'auto', 'enabled', 'on'. Must match actual entity values.

**`entity set operating mode off`**

Value to send to operating mode entity for 'OFF' state. Example: 'manual', 'disabled', 'off'. Must match actual entity values.

**`entity stop inverter`**

Optional: Home Assistant entity to emergency stop the battery inverter. Rarely needed but available for safety scenarios.

**`entity balance switch`**

Optional: Home Assistant entity to enable/disable grid balancing mode. Used for frequency regulation participation or grid services.

**`entity from battery`**

Optional: Home Assistant sensor showing current power flow from battery in watts. Used for monitoring and validation.

**`entity from pv`**

Optional: Home Assistant sensor showing current DC-coupled solar power in watts. Only relevant for DC-coupled solar installations.

**`entity from ac`**

Optional: Home Assistant sensor showing current AC grid power flow in watts. Used for monitoring overall system balance.

**`entity calculated soc`**

Optional: Home Assistant sensor for calculated State of Charge. System can compute SOC from power flows if BMS sensor is unavailable.

**`solar`**

Optional: Configure DC-coupled solar panels directly connected to this battery inverter. DC coupling is more efficient than AC coupling. Leave empty for AC-coupled or grid-only batteries.

</details>


---

## Energy Production

<a id="energy-production"></a>

### ‚òÄÔ∏è SolarConfig

_Solar panel configuration._

# Solar Panel Configuration

Configure your solar panel installations for accurate production forecasting.

## Configuration Options

### Simple Configuration
For panels all facing the same direction, use the flat config:
- **tilt**: Panel angle (0-90¬∞)
- **orientation**: Direction panels face (0=south)
- **capacity**: Total capacity in kWp
- **yield**: Efficiency factor (0.8-0.9)

### Advanced Configuration (Multiple Strings)
For panels facing different directions, use the 'strings' configuration:
- Each string can have different tilt and orientation
- Allows accurate modeling of complex installations
- Example: Panels on both south and east-facing roofs

## Tips
- Use strings configuration for multi-directional installations
- Include all inverter and cable losses in yield factor
- Account for shading in yield factor


üìö [**View detailed documentation ‚Üí**](https://github.com/corneel27/day-ahead/wiki/Solar-Configuration)

| Field | Type | Required | Default | Description |
|-------|------|----------|---------|-------------|
| `name` | string | Yes | ‚Äî | Solar installation name/identifier |
| `entity pv switch` | string (optional) | No | `null` | HA entity to enable/disable this solar installation |
| `tilt` | number (optional) | No | `null` | Panel tilt (for single installation) (Unit: `degrees`) _0-90 degrees, leave empty when using strings_ |
| `orientation` | number (optional) | No | `null` | Panel orientation (for single installation) (Unit: `degrees`) _-180 to 180 degrees, leave empty when using strings_ |
| `capacity` | number (optional) | No | `null` | Installed capacity (for single installation) (Unit: `kWp`) _Greater than 0, leave empty when using strings_ |
| `yield` | number (optional) | No | `null` | Yield factor (for single installation) (Unit: `ratio`) _Greater than 0, typically 0.8-0.9, leave empty when using strings_ |
| `strings` | list[[SolarString](#solarstring)] (optional) | No | `null` | Multiple panel strings with different configurations |

<details>
<summary><b>üìñ Field Details</b> (click to expand)</summary>

**`name`**

Unique name for this solar installation. Use descriptive names like 'Roof South' or 'Garage East' for multiple installations.

**`entity pv switch`**

Optional Home Assistant entity to enable or disable this solar installation in the optimization. Useful for maintenance or testing.

**`tilt`**

Panel tilt angle for simple configuration. Use this OR 'strings', not both. Leave empty if using strings configuration.

**`orientation`**

Panel orientation for simple configuration. Use this OR 'strings', not both. Leave empty if using strings configuration.

**`capacity`**

Total capacity for simple configuration. Use this OR 'strings', not both. Leave empty if using strings configuration.

**`yield`**

Yield factor for simple configuration. Use this OR 'strings', not both. Leave empty if using strings configuration.

**`strings`**

Advanced: Configure multiple strings for panels with different orientations or tilts. Use this OR flat config (tilt/orientation/capacity/yield), not both.

</details>


---

## Devices

<a id="devices"></a>

### üöó EVConfig

_Electric Vehicle configuration._

# Electric Vehicle Configuration

Optimize EV charging based on electricity prices, solar production, and charging deadlines.

## Charging Modes

### Instant Charging
Use `entity_instant_start` + `entity_instant_level` for immediate charging:
- Trigger instant_start to charge now
- System charges to instant_level immediately
- Simpler but less cost-optimized

### Scheduled Charging
Use `charge_scheduler` for time-based optimization:
- Set target level and ready datetime
- System optimizes when to charge for lowest cost
- Ensures vehicle is ready by deadline
- More complex but better cost optimization

## Requirements
- Must configure EITHER instant charging OR scheduler (not both)
- Vehicle must be home (device tracker)
- Vehicle must be plugged in (binary sensor)
- Charger must support amperage control

## Tips
- Use multiple charge stages for better efficiency modeling
- Three-phase charging (11/22kW) much faster than single-phase (3.7/7.4kW)
- Consider time-of-use tariffs when setting charge deadlines


üìö [**View detailed documentation ‚Üí**](https://github.com/corneel27/day-ahead/wiki/EV-Configuration)

| Field | Type | Required | Default | Description |
|-------|------|----------|---------|-------------|
| `name` | string | Yes | ‚Äî | EV name/identifier |
| `capacity` | number | Yes | ‚Äî | Battery capacity in kWh (Unit: `kWh`) _Must be > 0, typically 40-100 kWh_ |
| `entity position` | string | Yes | ‚Äî | HA device tracker for vehicle position |
| `charge three phase` | boolean or string | No | `true` | Whether vehicle charges on three phases |
| `charge stages` | list[[EVChargeStage](#evchargestage)] | Yes | ‚Äî | Charging amperage/efficiency curve _At least 1 stage required_ |
| `entity actual level` | string | Yes | ‚Äî | HA entity for current battery level % (Unit: `%`) |
| `entity plugged in` | string | Yes | ‚Äî | HA binary sensor for plugged in status |
| `entity instant start` | string (optional) | No | `null` | HA entity for instant start charging |
| `entity instant level` | string (optional) | No | `null` | HA entity for instant charge level target (Unit: `%`) |
| `charge scheduler` | [EVChargeScheduler](#evchargescheduler) (optional) | No | `null` | Charge scheduling configuration |
| `charge switch` | string | Yes | ‚Äî | HA switch entity to control charging |
| `entity set charging ampere` | string | Yes | ‚Äî | HA entity to set charging amperage (Unit: `A`) |
| `entity stop charging` | string | Yes | ‚Äî | HA entity for stop charging datetime |

<details>
<summary><b>üìñ Field Details</b> (click to expand)</summary>

**`name`**

Unique name for this electric vehicle. Use descriptive names like 'Tesla Model 3' or 'Polestar 2' for multiple vehicles.

**`capacity`**

Usable battery capacity in kilowatt-hours. Check vehicle specifications (often less than advertised total capacity).

**`entity position`**

Home Assistant device tracker entity to detect if vehicle is home. Charging is only scheduled when vehicle is at home location.

**`charge three phase`**

True for three-phase charging (11kW/22kW), False for single-phase (3.7kW/7.4kW). Can also be HA entity ID for dynamic resolution.

**`charge stages`**

Charging curve defined by amperage stages and their efficiencies. At least one stage required. Multiple stages enable optimization of charging speed.

**`entity actual level`**

Home Assistant sensor showing current battery State of Charge in percent. Required for charge optimization.

**`entity plugged in`**

Home Assistant binary sensor indicating if vehicle is plugged into charger. Charging is only possible when plugged in.

**`entity instant start`**

Optional: Home Assistant entity to trigger immediate charging. Use with entity_instant_level for instant charging mode. Alternative to charge_scheduler.

**`entity instant level`**

Optional: Home Assistant entity for instant charge target level. When instant_start triggers, system charges to this level immediately. Alternative to charge_scheduler.

**`charge scheduler`**

Optional: Advanced scheduler for time-based charging. Optimizes when to charge to meet deadline at lowest cost. Alternative to instant charging.

**`charge switch`**

Home Assistant switch entity to start/stop charging. System will control this to execute optimized charging schedule.

**`entity set charging ampere`**

Home Assistant entity to control charging current in amperes. System will adjust this to optimize charging speed and cost.

**`entity stop charging`**

Home Assistant datetime entity specifying when to stop charging. Provides manual override of optimized schedule.

</details>


### üß∫ MachineConfig

_Appliance/machine configuration (washing machine, dishwasher, etc.)._

# Appliance / Machine Configuration

Optimize operation of flexible load appliances (washing machines, dishwashers, dryers, etc.) based on electricity prices and constraints.

## How It Works

The system optimizes when to start appliances within time windows:
1. User sets start window (earliest start) and end window (must finish by)
2. User selects program (each program has a power profile)
3. System calculates optimal start time to minimize cost
4. System writes calculated start time to HA entity
5. User/automation triggers machine at optimal time

## Programs

Each program defines power consumption over time:
- **Power profile**: List of watts per time interval
- **Duration**: Length of power list (e.g., 5 values = 5 hours)
- **'off' program**: Required, with zero power consumption

Examples:
- Eco wash: `[1800, 1800, 400, 400, 100]` (5 hours)
- Quick wash: `[2200, 500, 100]` (3 hours)
- Off: `[]` or `[0]`

## Time Windows

- **Start window**: Earliest allowed start (e.g., "now" or "20:00")
- **End window**: Latest allowed finish (e.g., "08:00 next day")
- System finds cheapest start time within window
- Machine must complete before end window

## Tips

- Define accurate power profiles for each program
- Set realistic time windows (at least program duration)
- Wider time windows = better optimization opportunities
- Combine with solar production forecasts
- Use instant start for urgent loads
- Multiple machines can be optimized together


üìö [**View detailed documentation ‚Üí**](https://github.com/corneel27/day-ahead/wiki/Machine-Configuration)

| Field | Type | Required | Default | Description |
|-------|------|----------|---------|-------------|
| `name` | string | Yes | ‚Äî | Machine name/identifier |
| `programs` | list[[MachineProgram](#machineprogram)] | Yes | ‚Äî | Available programs with power profiles _At least 1 program required, include 'off' program_ |
| `entity start window` | string | Yes | ‚Äî | HA entity for start window datetime |
| `entity end window` | string | Yes | ‚Äî | HA entity for end window datetime |
| `entity selected program` | string | Yes | ‚Äî | HA entity for selected program |
| `entity calculated start` | string | Yes | ‚Äî | HA entity for calculated optimal start time |
| `entity calculated end` | string | Yes | ‚Äî | HA entity for calculated end time |
| `entity instant start` | string (optional) | No | `null` | HA entity for instant start |

<details>
<summary><b>üìñ Field Details</b> (click to expand)</summary>

**`name`**

Unique name for this appliance. Use descriptive names like 'Washing Machine', 'Dishwasher', or 'Dryer' for multiple machines.

**`programs`**

List of available programs with their power profiles. Must include at least one program. Always include an 'off' program with zero power consumption.

**`entity start window`**

Home Assistant datetime entity for earliest allowed start time. Machine can start any time after this. Example: 'Now' or '18:00 today'.

**`entity end window`**

Home Assistant datetime entity for latest allowed completion time. Machine must finish before this deadline. Example: '08:00 tomorrow'.

**`entity selected program`**

Home Assistant entity to select which program to run. Must match program names defined in 'programs' list.

**`entity calculated start`**

Home Assistant entity where system writes the calculated optimal start time. User/automation can use this to trigger machine.

**`entity calculated end`**

Home Assistant entity where system writes the calculated program end time. Useful for notifications and planning.

**`entity instant start`**

Optional: Home Assistant entity to force immediate start, bypassing optimization. Useful for urgent wash cycles.

</details>


---

## Heating & Climate

<a id="heating-and-climate"></a>

### üå°Ô∏è HeatingConfig

_Heating system / heat pump configuration._

# Heat Pump Configuration

Optimize heat pump operation based on electricity prices, heat demand, and weather conditions.

## Key Concepts

### COP (Coefficient of Performance)
Ratio of heat output to electrical input. Higher is better:
- COP 3.0 = 3 kW heat from 1 kW electricity (300% efficient)
- COP 4.0 = 4 kW heat from 1 kW electricity (400% efficient)
- Varies with outdoor temperature and power level

### Adjustment Modes
- **on/off**: Simple binary control (least flexible)
- **power**: Variable power control (recommended for variable-speed pumps)
- **heating curve**: Adjust water temperature based on outdoor temp (most advanced)

### Stages
Define power levels and corresponding COP values:
- Single stage: Fixed power heat pump
- Multiple stages: Variable-speed compressor with better efficiency
- Must be sorted by power (ascending)

## Tips
- Use degree_days_factor to calibrate heat demand for your building
- Set min_run_length to prevent excessive cycling (2-4h typical)
- Higher COP = cheaper heating, maximize runtime during high-COP conditions
- Consider solar production when scheduling heating loads


üìö [**View detailed documentation ‚Üí**](https://github.com/corneel27/day-ahead/wiki/Heating-Configuration)

| Field | Type | Required | Default | Description |
|-------|------|----------|---------|-------------|
| `heater present` | boolean or string | No | `false` | Whether heating system is present/enabled |
| `entity hp enabled` | string (optional) | No | `null` | HA binary sensor for heat pump enabled status |
| `degree days factor` | number | No | `1.0` | Degree days factor for heat demand calculation (Unit: `factor`) _Must be > 0, typically 0.5-2.0_ |
| `adjustment` | string | No | `"power"` | Adjustment mode. Options: `on/off`, `power`, `heating curve` |
| `stages` | list[[HeatingStage](#heatingstage)] | Yes | ‚Äî | Heating power/COP stages _At least 1 stage, must be sorted by max_power_ |
| `entity adjust heating curve` | string (optional) | No | `null` | HA entity to adjust heating curve |
| `adjustment factor` | number (optional) | No | `null` | Factor for heating curve adjustment (Unit: `factor`) _Typically 0.5-2.0 if specified_ |
| `min run length` | integer | No | `1` | Minimum run length in time intervals (Unit: `intervals`) _Must be >= 1, typically 2-4 for 1h intervals_ |
| `entity hp heat produced` | string (optional) | No | `null` | HA entity for heat produced (Unit: `kWh`) |
| `entity hp heat demand` | string (optional) | No | `null` | HA entity for heat demand (Unit: `W`) |
| `entity avg temp` | string (optional) | No | `null` | HA entity for average temperature (Unit: `¬∞C`) |
| `entity hp cop` | string (optional) | No | `null` | HA entity for heat pump COP (Unit: `ratio`) |
| `entity hp power` | string (optional) | No | `null` | HA entity for heat pump power (Unit: `W`) |
| `entity hp switch` | string (optional) | No | `null` | HA entity to control heat pump on/off |

<details>
<summary><b>üìñ Field Details</b> (click to expand)</summary>

**`heater present`**

Enable heating system optimization. Set to true to include heat pump in optimization, false to disable. Can also be HA entity ID for dynamic control.

**`entity hp enabled`**

Optional: Home Assistant binary sensor indicating if heat pump is enabled and operational. System will only optimize when enabled.

**`degree days factor`**

Multiplier for degree-day heat demand calculation. Adjust based on building insulation and heat loss. Higher = more heat needed. Typical: 0.5-2.0.

**`adjustment`**

Heat pump control mode: 'on/off' = simple binary control, 'power' = variable power control, 'heating curve' = adjust heating curve based on weather.

**`stages`**

Power and efficiency stages for heat pump. At least one stage required. Multiple stages model variable-speed compressors. Must be sorted by power ascending.

**`entity adjust heating curve`**

Optional: Home Assistant entity to adjust heating curve. Used when adjustment mode is 'heating curve'. Controls water temperature based on outdoor temperature.

**`adjustment factor`**

Optional: Multiplier for heating curve adjustments. Higher values = more aggressive adjustments. Typical: 0.5-2.0.

**`min run length`**

Minimum number of consecutive time intervals heat pump must run once started. Prevents excessive on/off cycling which reduces efficiency and equipment life. Typical: 2-4 intervals (2-4 hours).

**`entity hp heat produced`**

Optional: Home Assistant sensor showing total heat energy produced. Used for monitoring and validation.

**`entity hp heat demand`**

Optional: Home Assistant sensor showing current heat demand. Can be used instead of degree-day calculation for more accurate demand forecasting.

**`entity avg temp`**

Optional: Home Assistant sensor for outdoor average temperature. Used for degree-day calculations and COP adjustments.

**`entity hp cop`**

Optional: Home Assistant sensor showing current COP. Can be used for monitoring or to override stage-based COP calculations.

**`entity hp power`**

Optional: Home Assistant sensor showing current electrical power consumption. Used for monitoring and validation.

**`entity hp switch`**

Optional: Home Assistant switch to control heat pump on/off. Used by scheduler to execute optimized heating schedule.

</details>


### üíß BoilerConfig

_Hot water boiler configuration._

# Hot Water Boiler Configuration

Optimize hot water heating based on electricity prices, usage patterns, and thermal characteristics.

## How It Works

The system models boiler as a thermal battery:
- Water stores heat energy based on volume and temperature
- Heat is lost over time based on cooling_rate
- System schedules heating during cheap electricity periods
- Ensures hot water availability when needed

## Key Parameters

### Temperature Control
- **setpoint**: Target temperature (typically 55-65¬∞C)
- **hysterese**: Dead band to prevent cycling (typically 3-5¬∞C)
- **heating_allowed_below**: Max temp to start heating

### Physical Properties
- **volume**: Tank size affects how much heat can be stored
- **cooling_rate**: Heat loss rate (better insulation = lower rate)
- **elec_power**: Heating power affects heating duration
- **cop**: Efficiency (1.0 for resistive, 2.5-4.0 for heat pump)

### Activation
- **activate_entity**: Button/switch to trigger heating
- **activate_service**: Service type ('press' or 'switch')

## Tips
- Larger volume = more thermal storage capacity
- Better insulation = lower cooling_rate = more flexibility
- Heat pump water heaters (COP > 1.0) much more efficient than resistive
- Schedule heating during solar production or cheap grid periods
- Instant start available for emergency hot water needs


üìö [**View detailed documentation ‚Üí**](https://github.com/corneel27/day-ahead/wiki/Boiler-Configuration)

| Field | Type | Required | Default | Description |
|-------|------|----------|---------|-------------|
| `boiler present` | boolean or string | No | `true` | Whether boiler is present/enabled |
| `entity actual temp.` | string | Yes | ‚Äî | HA entity for actual water temperature (Unit: `¬∞C`) |
| `entity setpoint` | string | Yes | ‚Äî | HA entity for temperature setpoint (Unit: `¬∞C`) |
| `entity hysterese` | string | Yes | ‚Äî | HA entity for temperature hysteresis (Unit: `¬∞C`) |
| `entity boiler enabled` | string (optional) | No | `null` | HA entity for boiler enabled status |
| `entity instant start` | string (optional) | No | `null` | HA entity for instant start |
| `cop` | number | No | `3.0` | Coefficient of Performance (Unit: `ratio`) _Must be > 0, use 1.0 for resistive, 2.5-4.0 for heat pump_ |
| `cooling rate` | number | Yes | ‚Äî | Cooling rate in degrees per hour (Unit: `¬∞C/h`) _Must be >= 0, typically 0.5-2.0¬∞C/h_ |
| `volume` | number | No | `200.0` | Water volume in liters (Unit: `L`) _Must be > 0, typically 100-300L_ |
| `heating allowed below` | number | Yes | ‚Äî | Temperature below which heating is allowed (Unit: `¬∞C`) _Should be >= setpoint_ |
| `elec. power` | number | No | `1000.0` | Electrical power in watts (Unit: `W`) _Must be > 0, typically 1000-3000W_ |
| `activate service` | string | Yes | ‚Äî | Service type to activate boiler (e.g., 'press', 'switch') |
| `activate entity` | string | Yes | ‚Äî | HA entity to activate boiler |

<details>
<summary><b>üìñ Field Details</b> (click to expand)</summary>

**`boiler present`**

Enable hot water boiler optimization. Set to true to include boiler in optimization, false to disable. Can also be HA entity ID for dynamic control.

**`entity actual temp.`**

Home Assistant sensor showing current hot water temperature in ¬∞C. Required for thermal state tracking and heating decisions.

**`entity setpoint`**

Home Assistant entity for target water temperature. System will heat water to this temperature. Typical: 55-65¬∞C for domestic hot water.

**`entity hysterese`**

Home Assistant entity for temperature hysteresis in ¬∞C. Prevents excessive cycling. If setpoint=60¬∞C and hysteresis=5¬∞C, heating starts at 55¬∞C.

**`entity boiler enabled`**

Optional: Home Assistant binary sensor indicating if boiler is enabled. System will only optimize when boiler is enabled.

**`entity instant start`**

Optional: Home Assistant entity to trigger immediate boiler heating. Overrides optimized schedule for on-demand hot water.

**`cop`**

Coefficient of Performance if using heat pump water heater. For resistive heating element, use 1.0. For heat pump water heater, typically 2.5-4.0.

**`cooling rate`**

Rate at which water temperature drops when not heating, in ¬∞C per hour. Depends on insulation quality. Typical: 0.5-2.0¬∞C/h for well-insulated boilers.

**`volume`**

Hot water tank volume in liters. Affects thermal inertia and heating time. Typical residential: 100-300 liters.

**`heating allowed below`**

Maximum temperature for starting heating cycle. Heating only occurs when water is below this temperature. Typically same as or slightly above setpoint.

**`elec. power`**

Electrical power consumption of heating element or heat pump compressor in watts. Typical: 1000-3000W for resistive, 400-800W for heat pump water heater.

**`activate service`**

Home Assistant service type to trigger boiler heating. Use 'press' for button entities, 'switch' for switch entities, or custom service names.

**`activate entity`**

Home Assistant entity used to activate boiler heating. System will trigger this entity using activate_service when heating is needed.

</details>


---

## Infrastructure

<a id="infrastructure"></a>

### üíæ DatabaseConfig

_Day Ahead database configuration (database da).

Can be either SQLite, MySQL/MariaDB, or PostgreSQL._

# Day Ahead Database Configuration

Database for storing Day Ahead optimizer calculations, schedules, and results.

## Engine Options

### SQLite (Recommended for most users)
- **Pros**: No server setup, simple, included with Home Assistant
- **Cons**: Single-user, not suitable for multiple HA instances
- **Config**: Specify db_path and/or database filename

### MySQL/MariaDB
- **Pros**: Multi-user, robust, good performance
- **Cons**: Requires separate database server
- **Config**: server, port, username, password, database name

### PostgreSQL
- **Pros**: Advanced features, excellent for large datasets
- **Cons**: Requires separate database server, more complex
- **Config**: server, port, username, password, database name

## Security

**Never store passwords in options.json!**

Use secrets.json:
```json
{
  "db_password": "actual_password_here"
}
```

Then in options.json:
```json
"password": "!secret db_password"
```

## Tips

- SQLite for single HA instance (simplest)
- MySQL for shared database or multiple instances
- Use strong passwords for server-based databases
- Ensure database is backed up (contains optimization history)
- Check database size periodically (can grow with history)


üìö [**View detailed documentation ‚Üí**](https://github.com/corneel27/day-ahead/wiki/Database-Configuration)

| Field | Type | Required | Default | Description |
|-------|------|----------|---------|-------------|
| `engine` | string | No | `"sqlite"` | Database engine type. Options: `sqlite`, `mysql`, `postgresql` |
| `db_path` | string (optional) | No | `null` | Database path for SQLite (e.g., '../data') _Required for SQLite (or use database field)_ |
| `database` | string (optional) | No | `null` | Database filename for SQLite or database name for MySQL _Filename for SQLite, database name for MySQL/PostgreSQL_ |
| `server` | string (optional) | No | `null` | MySQL server hostname (required for mysql) _Required for mysql/postgresql engines_ |
| `port` | integer (optional) | No | `null` | MySQL/PostgreSQL server port (required for mysql/postgresql) (Unit: `port`) _1-65535, required for mysql/postgresql_ |
| `username` | string (optional) | No | `null` | MySQL username (required for mysql) _Required for mysql/postgresql engines_ |
| `password` | string or [SecretStr](#secretstr) (optional) | No | `null` | MySQL password (can use !secret) _Use !secret for passwords_ |
| `time_zone` | string (optional) | No | `null` | Database timezone |

<details>
<summary><b>üìñ Field Details</b> (click to expand)</summary>

**`engine`**

Database engine for Day Ahead optimizer data. SQLite is simplest (no server needed), MySQL/PostgreSQL for advanced setups or shared databases.

**`db_path`**

Directory path for SQLite database file. Relative to add-on root. Example: '../data' stores in persistent data folder. Only for SQLite.

**`database`**

For SQLite: filename (e.g., 'day_ahead.db'). For MySQL/PostgreSQL: database name. At least one of db_path or database required for SQLite.

**`server`**

Hostname or IP of MySQL/PostgreSQL server. Required for server-based engines. Examples: 'localhost', '192.168.1.100'.

**`port`**

Database server port. Required for MySQL/PostgreSQL. Standard ports: 3306 (MySQL), 5432 (PostgreSQL).

**`username`**

Database username for authentication. Required for MySQL/PostgreSQL.

**`password`**

Database password. Use secrets.json with '!secret password_key' for security. Never store passwords directly in config.

**`time_zone`**

Optional: Timezone for database timestamps. Examples: 'Europe/Amsterdam', 'UTC'. Usually not needed if database and system timezones match.

</details>


### ‚ö° GridConfig

_Electrical grid connection configuration._

# Grid Connection Configuration

Define electrical grid connection limits to prevent overload.

## Maximum Grid Power

Based on your main fuse/circuit breaker:
- **1-phase 32A**: 7.4 kW (32A √ó 230V)
- **3-phase 25A**: 17.3 kW (25A √ó 230V √ó 3)
- **3-phase 35A**: 24.2 kW (35A √ó 230V √ó 3)

## Why This Matters

Optimizer ensures combined consumption never exceeds this limit:
- Prevents main fuse from tripping
- Ensures legal compliance with grid connection
- Coordinates multiple high-power devices (EV, heat pump, boiler)

## Tips

- Check your electrical panel for fuse/breaker rating
- Account for baseload when calculating available power
- System will prioritize loads within this constraint
- Consider upgrade if frequently hitting limits


üìö [**View detailed documentation ‚Üí**](https://github.com/corneel27/day-ahead/wiki/Grid-Configuration)

| Field | Type | Required | Default | Description |
|-------|------|----------|---------|-------------|
| `max_power` | number | No | `17` | Maximum grid power in kW (Unit: `kW`) _Must be > 0, typical 7-25 kW for residential_ |

<details>
<summary><b>üìñ Field Details</b> (click to expand)</summary>

**`max_power`**

Maximum power available from grid connection in kilowatts. Based on your main fuse/circuit breaker rating. Typical residential: 1-phase=7.4kW (32A), 3-phase=17kW (25A) or 25kW (35A). Prevents optimization from exceeding grid capacity.

</details>


### ‚è∞ HistoryConfig

_History and data retention settings._

# History & Data Retention

Control how long optimization history is retained in the database.

## What Gets Stored

- Optimization results (costs, schedules)
- Price data (day-ahead, tariffs)
- Device schedules (battery, EV, heating)
- Solar production forecasts
- Baseload consumption data

## Retention Guidelines

- **7 days**: Minimal retention, recent data only
- **14 days**: Two weeks for comparison
- **30 days**: Monthly trends and analysis
- **90+ days**: Long-term analysis (larger database)

## Database Growth

- More retention = larger database
- Typical: ~1-5 MB per day (depends on devices)
- Monitor database size if using SQLite
- Consider periodic backups

## Tips

- Start with 7-14 days, increase if needed
- Check database size regularly
- Old data cleaned up automatically
- Increase for detailed cost analysis


üìö [**View detailed documentation ‚Üí**](https://github.com/corneel27/day-ahead/wiki/History-Configuration)

| Field | Type | Required | Default | Description |
|-------|------|----------|---------|-------------|
| `save days` | integer | No | `7` | Number of days to retain historical data (Unit: `days`) _Must be >= 1, typical 7-30 days_ |

<details>
<summary><b>üìñ Field Details</b> (click to expand)</summary>

**`save days`**

Number of days to retain optimization history in database. Older data is automatically cleaned up. Longer retention enables better trend analysis but increases database size. Minimum 1 day.

</details>


---

## Pricing & Markets

<a id="pricing-and-markets"></a>

### üí∞ PricingConfig

_Day-ahead pricing and tariff configuration._

# Pricing & Tariff Configuration

Configure electricity market prices and tariff components for accurate cost optimization.

## Price Components

Total electricity cost consists of:
1. **Market price**: Day-ahead spot price (nordpool/entsoe/tibber)
2. **Energy taxes**: Government energy taxes
3. **Supplier costs**: Your supplier's markup/fees
4. **VAT**: Value-added tax on sum of above

Consumption price = (market + taxes + supplier) √ó (1 + VAT)

## Date-Based Tariffs

All tariff fields use date-indexed dictionaries:
```json
{
  "2024-01-01": 0.05,
  "2024-07-01": 0.06
}
```

System uses tariff active on optimization date.

## Data Sources

- **nordpool**: Nord Pool (Nordic/Baltic markets)
- **entsoe**: ENTSO-E Transparency Platform (all European markets)
- **tibber**: Tibber API (if using Tibber as supplier)

## Tips

- All prices are EXCLUDING VAT (VAT applied separately)
- Update tariffs when your supplier changes prices
- Use !secret for API keys
- Production costs often lower than consumption (or negative for feed-in credit)
- Keep last_invoice updated for accurate cost tracking
- Check your electricity bill for exact tariff components


üìö [**View detailed documentation ‚Üí**](https://github.com/corneel27/day-ahead/wiki/Pricing-Configuration)

| Field | Type | Required | Default | Description |
|-------|------|----------|---------|-------------|
| `source day ahead` | string | No | `"nordpool"` | Source for day-ahead prices. Options: `nordpool`, `entsoe`, `tibber` |
| `entsoe-api-key` | string or [SecretStr](#secretstr) (optional) | No | `null` | ENTSO-E API key (can use !secret) _Required for entsoe source, use !secret_ |
| `energy taxes consumption` | object | Yes | ‚Äî | Energy taxes for consumption by date (YYYY-MM-DD -> euro/kWh ex VAT) (Unit: `‚Ç¨/kWh`) _Dict with YYYY-MM-DD keys, float values (ex VAT)_ |
| `energy taxes production` | object | Yes | ‚Äî | Energy taxes for production by date (YYYY-MM-DD -> euro/kWh ex VAT) (Unit: `‚Ç¨/kWh`) _Dict with YYYY-MM-DD keys, float values (ex VAT)_ |
| `cost supplier consumption` | object | Yes | ‚Äî | Supplier costs for consumption by date (YYYY-MM-DD -> euro/kWh ex VAT) (Unit: `‚Ç¨/kWh`) _Dict with YYYY-MM-DD keys, float values (ex VAT)_ |
| `cost supplier production` | object | Yes | ‚Äî | Supplier costs for production by date (YYYY-MM-DD -> euro/kWh ex VAT) (Unit: `‚Ç¨/kWh`) _Dict with YYYY-MM-DD keys, float values (ex VAT)_ |
| `vat consumption` | object | Yes | ‚Äî | VAT percentage for consumption by date (YYYY-MM-DD -> %) (Unit: `%`) _Dict with YYYY-MM-DD keys, integer 0-100 values_ |
| `vat production` | object | Yes | ‚Äî | VAT percentage for production by date (YYYY-MM-DD -> %) (Unit: `%`) _Dict with YYYY-MM-DD keys, integer 0-100 values_ |
| `last invoice` | string | Yes | ‚Äî | Date of last invoice (YYYY-MM-DD) _Must be YYYY-MM-DD format_ |
| `tax refund` | boolean or string | Yes | ‚Äî | Whether tax refund applies |

<details>
<summary><b>üìñ Field Details</b> (click to expand)</summary>

**`source day ahead`**

Data source for day-ahead electricity market prices. 'nordpool' for Nordic/Baltic, 'entsoe' for European markets, 'tibber' if using Tibber integration.

**`entsoe-api-key`**

API key for ENTSO-E Transparency Platform. Required if source_day_ahead='entsoe'. Get free key at transparency.entsoe.eu. Use !secret for security.

**`energy taxes consumption`**

Energy taxes on consumption (excluding VAT) indexed by effective date. Format: {'2024-01-01': 0.05}. Use date when tariff changes.

**`energy taxes production`**

Energy taxes on feed-in/production (excluding VAT) indexed by effective date. Often zero or negative. Format: {'2024-01-01': 0.0}.

**`cost supplier consumption`**

Supplier markup/fees for consumption (excluding VAT) indexed by effective date. Fixed part of electricity cost. Format: {'2024-01-01': 0.02}.

**`cost supplier production`**

Supplier fees for feed-in/production (excluding VAT) indexed by effective date. May be negative (credit). Format: {'2024-01-01': -0.02}.

**`vat consumption`**

VAT percentage on consumption indexed by effective date. Format: {'2024-01-01': 21}. Applied to market price + taxes + supplier costs.

**`vat production`**

VAT percentage on feed-in/production indexed by effective date. Format: {'2024-01-01': 21}. Often same as consumption VAT.

**`last invoice`**

Date of last electricity invoice. Used for calculating costs since last billing period. Format: YYYY-MM-DD. Update after receiving invoices.

**`tax refund`**

Enable tax refund calculation if eligible. Some regions/users get energy tax refunds for solar production. Can be boolean or HA entity ID.

</details>


---

## Visualization

<a id="visualization"></a>

### üìà GraphicsConfig

_Graphics and visualization settings._

# Graphics & Visualization

Configure graphs and visualizations of optimization results.

## Graph Types

Graphs can show:
- **Battery balance**: SOC and charge/discharge schedule
- **Prices**: Consumption, production, and spot prices
- **Average consumption**: Baseline vs optimized usage

## When to Use

- Enable during testing to visualize optimization
- Useful for understanding system behavior
- Can be displayed in Home Assistant dashboard
- Disable in production if graphs not needed (saves resources)

## Tips

- Graphs saved to add-on data directory
- Use dark_background style to match HA theme
- Toggle individual elements to simplify graphs
- Graphs regenerated each optimization run


üìö [**View detailed documentation ‚Üí**](https://github.com/corneel27/day-ahead/wiki/Graphics)

| Field | Type | Required | Default | Description |
|-------|------|----------|---------|-------------|
| `style` | string | No | `"dark_background"` | Matplotlib style (e.g., 'dark_background', 'default') |
| `show` | boolean or string | No | `"false"` | Whether to show graphics |
| `battery balance` | boolean or string | No | `"true"` | Show battery balance in graphs |
| `prices consumption` | boolean or string | No | `"true"` | Show consumption prices in graphs |
| `prices production` | boolean or string | No | `"false"` | Show production prices in graphs |
| `prices spot` | boolean or string | No | `"true"` | Show spot prices in graphs |
| `average consumption` | boolean or string | No | `"true"` | Show average consumption in graphs |

<details>
<summary><b>üìñ Field Details</b> (click to expand)</summary>

**`style`**

Matplotlib visual style for generated graphs. 'dark_background' matches Home Assistant dark theme. Other options: 'default', 'seaborn', 'ggplot', 'bmh', 'fivethirtyeight'.

**`show`**

Enable graph generation and display. Graphs show optimization results, prices, battery schedules. Set to true to enable, false to disable. Can be HA entity ID.

**`battery balance`**

Display battery state of charge and power flows in graphs. Shows charge/discharge schedule over time.

**`prices consumption`**

Display consumption prices (market + taxes + VAT) in graphs. Helps visualize expensive vs cheap periods.

**`prices production`**

Display feed-in/production prices in graphs. Useful if you have solar feed-in to compare consumption vs production value.

**`prices spot`**

Display raw day-ahead spot market prices (before taxes/markup) in graphs. Shows pure market price variations.

**`average consumption`**

Display average/baseline consumption in graphs. Helps understand optimization impact relative to normal usage.

</details>


---

## Integration

<a id="integration"></a>

### üîî NotificationsConfig

_Notification settings for Home Assistant._

# Notifications Configuration

Configure Home Assistant notifications for optimization events.

## Notification Types

### Startup Notifications (opstarten)
- Sent when add-on starts/restarts
- Useful for monitoring system health
- Helps diagnose startup issues

### Calculation Notifications (berekening)
- Sent after each optimization run
- Includes optimization summary:
  - Total costs (consumption/production)
  - Battery charge schedule
  - Device scheduling results
  - Warnings or errors

## Setup

1. Configure notification service in HA
2. Set notification_entity to your service
3. Enable desired notification types
4. Optional: Track activity with timestamp entity

## Tips

- Use mobile app notifications for important alerts
- Use persistent notifications for detailed results
- Disable during testing to avoid notification spam
- Consider automations based on last_activity_entity


üìö [**View detailed documentation ‚Üí**](https://github.com/corneel27/day-ahead/wiki/Notifications)

| Field | Type | Required | Default | Description |
|-------|------|----------|---------|-------------|
| `notification entity` | string (optional) | No | `null` | HA entity for notifications |
| `opstarten` | boolean or string | No | `"false"` | Send notification on startup |
| `berekening` | boolean or string | No | `"false"` | Send notification on calculation completion |
| `last activity entity` | string (optional) | No | `null` | HA entity to track last activity timestamp |

<details>
<summary><b>üìñ Field Details</b> (click to expand)</summary>

**`notification entity`**

Optional: Home Assistant notification service entity. Used to send notifications about optimization events. Example: 'notify.mobile_app' or 'notify.persistent_notification'.

**`opstarten`**

Send notification when Day Ahead Optimizer starts up. Useful for monitoring add-on status. Can be boolean or HA entity ID.

**`berekening`**

Send notification when optimization calculation completes. Includes summary of results (costs, battery schedule, etc.). Can be boolean or HA entity ID.

**`last activity entity`**

Optional: Home Assistant entity to update with last activity timestamp. Useful for monitoring and automations. Example: 'input_datetime.dao_last_run'.

</details>


### üìä DashboardConfig

_Dashboard web UI configuration._

# Dashboard Configuration

Configure web dashboard for monitoring and controlling Day Ahead Optimizer.

## Dashboard Features

- View optimization results
- Monitor device schedules
- Check price forecasts
- Review historical data
- Trigger manual optimization
- View graphs and reports

## Access

Access dashboard at:
- **Local**: http://homeassistant.local:PORT
- **IP**: http://YOUR_HA_IP:PORT

## Port Selection

- Default: 5000
- Must be unused port
- Check no conflicts with other services
- Must be >= 1024 (non-privileged)

## Tips

- Add to Home Assistant sidebar via iframe card
- Enable Ingress for secure access
- Use reverse proxy for external access
- Dashboard updates after each optimization


üìö [**View detailed documentation ‚Üí**](https://github.com/corneel27/day-ahead/wiki/Dashboard)

| Field | Type | Required | Default | Description |
|-------|------|----------|---------|-------------|
| `port` | integer | No | `5000` | Web UI port number (Unit: `port`) _1024-65535, default 5000_ |

<details>
<summary><b>üìñ Field Details</b> (click to expand)</summary>

**`port`**

Port number for Day Ahead Optimizer web dashboard. Access at http://homeassistant.local:PORT. Must be between 1024-65535 (non-privileged ports).

</details>


### ‚ö° TibberConfig

_Tibber API integration configuration._

# Tibber Integration

Connect to Tibber API for real-time prices and consumption data.

## What is Tibber?

Tibber is an electricity supplier offering:
- Real-time spot price electricity
- Hour-by-hour pricing
- Smart home integrations
- Carbon-aware pricing

## Setup

1. Sign up for Tibber account
2. Get API token from Tibber app:
   - Settings ‚Üí Developer ‚Üí Personal Token
3. Store in secrets.json:
   ```json
   {"tibber_token": "your_token_here"}
   ```
4. Reference in config:
   ```json
   "api_token": "!secret tibber_token"
   ```

## When to Use

- **Yes**: If Tibber is your electricity supplier
- **Yes**: Want real-time Tibber prices in optimization
- **No**: If using other price sources (nordpool, entsoe)

## API Usage

- Fetches hourly prices
- Retrieves consumption history
- Updates price forecasts
- Rate-limited (stay within API limits)

## Tips

- Always use !secret for API token
- Set pricing source to 'tibber' if using
- Tibber provides next-day prices after ~13:00 CET
- Combine with Tibber HA integration for full experience


üìö [**View detailed documentation ‚Üí**](https://github.com/corneel27/day-ahead/wiki/Tibber-Integration)

| Field | Type | Required | Default | Description |
|-------|------|----------|---------|-------------|
| `api_token` | string or [SecretStr](#secretstr) | Yes | ‚Äî | Tibber API token (can use !secret) _Use !secret for API tokens_ |
| `api url` | string (optional) | No | `"https://api.tibber.com/v1-beta/gql"` | Tibber API URL |

<details>
<summary><b>üìñ Field Details</b> (click to expand)</summary>

**`api_token`**

Tibber API access token. Get from Tibber app or developer portal. Use !secret for security. Required if using Tibber as price source.

**`api url`**

Tibber GraphQL API endpoint URL. Default is official API. Change only for testing or custom endpoints.

</details>


### üè† HomeAssistantConfig

_Home Assistant connection configuration._

# Home Assistant Connection

Configure connection to Home Assistant for API access.

## Auto-Detection (Recommended)

When running as Home Assistant add-on:
- ‚úÖ IP address auto-detected
- ‚úÖ Port auto-detected
- ‚úÖ Access token auto-provided
- ‚úÖ Protocol auto-detected

**Leave all fields empty for automatic configuration.**

## Manual Configuration

Only needed if:
- Running outside Home Assistant
- Auto-detection fails
- Using custom HA setup

### Long-Lived Access Token

1. In Home Assistant: Profile ‚Üí Security
2. Scroll to "Long-Lived Access Tokens"
3. Click "Create Token"
4. Name it "Day Ahead Optimizer"
5. Copy token immediately (shown once!)
6. Store in secrets.json:
   ```json
   {"ha_token": "your_token_here"}
   ```
7. Reference in config:
   ```json
   "token": "!secret ha_token"
   ```

## Troubleshooting

- **Connection refused**: Check IP/port
- **Unauthorized**: Token invalid or expired
- **SSL errors**: Check protocol setting
- **Timeout**: Network connectivity issues

## Tips

- Prefer auto-detection when possible
- Always use !secret for tokens
- Test connection from dashboard
- Check HA logs if issues persist


üìö [**View detailed documentation ‚Üí**](https://github.com/corneel27/day-ahead/wiki/Home-Assistant-Integration)

| Field | Type | Required | Default | Description |
|-------|------|----------|---------|-------------|
| `host` | string (optional) | No | `null` | Home Assistant IP address (auto-detected if not set) |
| `ip port` | integer (optional) | No | `null` | Home Assistant port (default: 8123) (Unit: `port`) _Default 8123, change if custom_ |
| `token` | string or [SecretStr](#secretstr) (optional) | No | `null` | Home Assistant long-lived access token (can use !secret) _Auto-provided as add-on, use !secret if manual_ |
| `protocol api` | string (optional) | No | `null` | API protocol |

<details>
<summary><b>üìñ Field Details</b> (click to expand)</summary>

**`host`**

Home Assistant IP address or hostname. Usually auto-detected when running as HA add-on. Set manually only if auto-detection fails. Examples: '192.168.1.100', 'homeassistant.local'.

**`ip port`**

Home Assistant web interface port. Default is 8123. Change only if using custom port. Usually auto-detected when running as add-on.

**`token`**

Long-lived access token for HA API. Usually auto-provided when running as add-on. Create manually: Profile ‚Üí Security ‚Üí Long-Lived Access Tokens. Use !secret for security.

**`protocol api`**

Protocol for Home Assistant API. 'http' for local access, 'https' for SSL/TLS. Usually auto-detected. Set manually only if needed.

</details>


---

## Reporting

<a id="reporting"></a>

### üìâ ReportConfig

_Reporting and sensor entity configuration._

# Reporting & Sensors Configuration

Configure Home Assistant sensors for comprehensive energy reporting.

## Purpose

Connect actual energy measurements to Day Ahead Optimizer:
- Compare actual vs optimized usage
- Track device-specific consumption
- Calculate efficiency metrics
- Generate cost reports
- Monitor carbon footprint

## Entity Lists

All entity fields accept lists of HA sensors:
```json
"entities_grid_consumption": [
  "sensor.grid_import_meter",
  "sensor.backup_meter"
]
```

## Key Measurements

### Grid
- **Consumption**: Total import from grid
- **Production**: Total export/feed-in to grid

### Solar
- **AC**: After inverter, to AC distribution
- **DC**: Before inverter, directly to battery

### Devices
- **EV**: Charging consumption
- **Heat Pump**: Heating/cooling consumption
- **Boiler**: Hot water heating consumption
- **Battery**: Charge/discharge tracking
- **Machines**: Appliance consumption

## Tips

- Use energy sensors (kWh cumulative)
- Multiple sensors per category are summed
- Essential for accurate cost reporting
- CO2 tracking optional but insightful
- Update when adding new monitoring devices


üìö [**View detailed documentation ‚Üí**](https://github.com/corneel27/day-ahead/wiki/Reports)

| Field | Type | Required | Default | Description |
|-------|------|----------|---------|-------------|
| `entities grid consumption` | list[string] | No | `null` | HA entities for grid consumption (Unit: `kWh`) |
| `entities grid production` | list[string] | No | `null` | HA entities for grid production (Unit: `kWh`) |
| `entities solar production ac` | list[string] | No | `null` | HA entities for AC solar production (Unit: `kWh`) |
| `entities solar production dc` | list[string] | No | `null` | HA entities for DC solar production (Unit: `kWh`) |
| `entities ev consumption` | list[string] | No | `null` | HA entities for EV consumption (Unit: `kWh`) |
| `entities wp consumption` | list[string] | No | `null` | HA entities for heat pump (warmtepomp) consumption (Unit: `kWh`) |
| `entities boiler consumption` | list[string] | No | `null` | HA entities for boiler consumption (Unit: `kWh`) |
| `entities battery consumption` | list[string] | No | `null` | HA entities for battery consumption (Unit: `kWh`) |
| `entities battery production` | list[string] | No | `null` | HA entities for battery production (Unit: `kWh`) |
| `entities machine consumption` | list[string] | No | `null` | HA entities for machine consumption (Unit: `kWh`) |
| `co2 intensity sensor` | string (optional) | No | `null` | HA entity for CO2 intensity (Unit: `gCO2/kWh`) |
| `sensors` | object (optional) | No | `null` | Additional sensors configuration |

<details>
<summary><b>üìñ Field Details</b> (click to expand)</summary>

**`entities grid consumption`**

List of Home Assistant sensor entities measuring grid consumption (import). Used for actual vs optimized comparison and reporting.

**`entities grid production`**

List of Home Assistant sensor entities measuring grid production (export/feed-in). Used for production reporting and solar surplus calculation.

**`entities solar production ac`**

List of Home Assistant sensor entities for AC-coupled solar production. After inverter, directly to AC side. Separate from DC-coupled solar.

**`entities solar production dc`**

List of Home Assistant sensor entities for DC-coupled solar production. Before inverter, directly to battery DC bus. Separate from AC-coupled solar.

**`entities ev consumption`**

List of Home Assistant sensor entities measuring EV charging consumption. Used for EV-specific energy reporting and cost allocation.

**`entities wp consumption`**

List of Home Assistant sensor entities measuring heat pump consumption. Used for heating-specific energy reporting and COP calculation.

**`entities boiler consumption`**

List of Home Assistant sensor entities measuring hot water boiler consumption. Used for boiler-specific energy reporting.

**`entities battery consumption`**

List of Home Assistant sensor entities measuring battery charging (consumption). Used for battery efficiency and cycling cost calculation.

**`entities battery production`**

List of Home Assistant sensor entities measuring battery discharging (production). Used for battery efficiency and round-trip calculation.

**`entities machine consumption`**

List of Home Assistant sensor entities measuring appliance/machine consumption (washing machine, dishwasher, etc.). Used for machine-specific reporting.

**`co2 intensity sensor`**

Optional: Home Assistant sensor for grid CO2 intensity (gCO2/kWh). Used to calculate and report carbon footprint of electricity usage.

**`sensors`**

Optional: Additional custom sensor configurations. Advanced use for extending reporting capabilities beyond standard entities.

</details>


---

## Automation

<a id="automation"></a>

### üïê SchedulerConfig

_Task scheduler configuration.

Maps time patterns to action names.
Time patterns can be:
- Specific times: "0435", "1255"
- Wildcards: "xx00" (every hour at :00), "xx15" (every hour at :15)

Actions include:
- get_meteo_data
- get_tibber_data
- get_day_ahead_prices
- calc_optimum
- clean_data
- calc_baseloads_

# Scheduler Configuration

Define when automatic tasks run using time patterns.

## Time Pattern Format

- **Specific time**: "0435" (4:35 AM), "1255" (12:55 PM)
- **Hourly wildcard**: "xx00" (every hour at :00), "xx15" (every hour at :15)
- **Format**: HHMM (24-hour, no colons)

## Available Actions

### Data Collection
- **get_meteo_data**: Fetch weather forecasts (solar irradiation, temperature)
- **get_tibber_data**: Fetch Tibber prices (if using Tibber)
- **get_day_ahead_prices**: Fetch day-ahead market prices

### Optimization
- **calc_optimum**: Run main optimization algorithm
- **calc_baseloads**: Calculate baseline consumption from history

### Maintenance
- **clean_data**: Clean up old data (runs save_days retention)

## Example Configuration

```json
{
  "0435": "get_day_ahead_prices",
  "0445": "get_meteo_data",
  "0500": "calc_optimum",
  "xx00": "calc_baseloads",
  "0300": "clean_data"
}
```

## Typical Schedule

1. **04:00-05:00**: Fetch prices and weather (after day-ahead auction)
2. **05:00**: Run optimization with fresh data
3. **Hourly**: Update baseload calculations
4. **03:00**: Clean old data (low activity time)

## Tips

- Day-ahead prices available after ~13:00 (CET) for next day
- Run optimization after all data fetched
- Hourly baseload updates improve accuracy
- Clean data during low activity (night)
- Avoid overlapping long-running tasks


üìö [**View detailed documentation ‚Üí**](https://github.com/corneel27/day-ahead/wiki/Scheduler)

*No configuration fields.*


---

## Other

<a id="other"></a>

### BatteryStage

_Single charge/discharge stage with power and efficiency._

Defines power and efficiency at a specific operating point. Multiple stages create a power/efficiency curve.

| Field | Type | Required | Default | Description |
|-------|------|----------|---------|-------------|
| `power` | number | Yes | ‚Äî | Power level in Watts (Unit: `W`) _Must be 0 or greater, stages should be sorted by power_ |
| `efficiency` | number | Yes | ‚Äî | Efficiency at this power level (0-1) (Unit: `ratio (0-1)`) _Must be between 0 and 1_ |

<details>
<summary><b>üìñ Field Details</b> (click to expand)</summary>

**`power`**

Power level for this charge/discharge stage. Stages define how battery efficiency changes at different power levels.

**`efficiency`**

Energy conversion efficiency at this power level. Value between 0 and 1, where 1 = 100% efficient.

</details>


### EVChargeScheduler

_EV charge scheduling configuration._

Advanced scheduler that optimizes charging to reach target level by specific deadline, minimizing cost by charging during cheapest hours.

| Field | Type | Required | Default | Description |
|-------|------|----------|---------|-------------|
| `entity set level` | string | Yes | ‚Äî | HA entity to set target charge level (Unit: `%`) |
| `level margin` | integer | Yes | ‚Äî | Margin in % for charge level completion (Unit: `%`) _Must be >= 0, typically 5-10%_ |
| `entity ready datetime` | string | Yes | ‚Äî | HA entity for ready datetime (when charging should complete) |

<details>
<summary><b>üìñ Field Details</b> (click to expand)</summary>

**`entity set level`**

Home Assistant entity to set the target battery level for scheduled charging. System will optimize when to charge to reach this level.

**`level margin`**

Acceptable margin below target level. Example: target=80%, margin=5% means 75-80% is acceptable. Provides flexibility in optimization.

**`entity ready datetime`**

Home Assistant datetime entity specifying when vehicle must be charged. System will optimize charging schedule to minimize cost while meeting deadline.

</details>


### EVChargeStage

_Single EV charging stage with amperage and efficiency._

Define charging curve by specifying amperage and efficiency pairs. Multiple stages allow accurate modeling of variable efficiency.

| Field | Type | Required | Default | Description |
|-------|------|----------|---------|-------------|
| `ampere` | integer | Yes | ‚Äî | Charging current in amperes (Unit: `A`) _Must be >= 0, typically 6-32A_ |
| `efficiency` | number | Yes | ‚Äî | Charging efficiency at this amperage (0-1) (Unit: `ratio`) _0.0-1.0, typically 0.85-0.95_ |

<details>
<summary><b>üìñ Field Details</b> (click to expand)</summary>

**`ampere`**

Charging current in amperes for this stage. Typical values: 6A (1.4kW), 10A (2.3kW), 16A (3.7kW), 32A (7.4kW) for single-phase.

**`efficiency`**

Charging efficiency ratio at this amperage level. Accounts for charger losses, cable losses, and battery acceptance. Typically 0.85-0.95.

</details>


### FlexValue

_A flexible value that can be either a literal or a Home Assistant entity ID.

Supports all HA entity types: int, float, str, bool

Examples:
    FlexValue(value=95)                    # Literal integer
    FlexValue(value="sensor.battery_soc")  # HA entity ID
    FlexValue(value=True)                  # Literal boolean
    FlexValue(value="binary_sensor.grid")  # HA entity ID_

FlexValue enables dynamic configuration using Home Assistant entities. Instead of hardcoding values, reference HA entities that can change at runtime. System automatically detects and resolves entity IDs.

| Field | Type | Required | Default | Description |
|-------|------|----------|---------|-------------|
| `value` | integer or number or string or boolean | Yes | ‚Äî | Value |
| `is_entity` | boolean | No | `false` | True if value is a HA entity ID |

<details>
<summary><b>üìñ Field Details</b> (click to expand)</summary>

**`value`**

Value can be a literal (number, boolean) OR a Home Assistant entity ID for dynamic runtime resolution. Entity IDs detected by presence of '.' (e.g., 'sensor.name').

**`is_entity`**

Automatically set to true if value contains '.' (entity ID pattern). Used internally to determine resolution strategy.

</details>


### HADatabaseConfig

_Home Assistant database connection configuration._

Home Assistant database connection for reading historical sensor data (prices, solar, baseload).

| Field | Type | Required | Default | Description |
|-------|------|----------|---------|-------------|
| `engine` | string | No | `"mysql"` | Database engine type. Options: `mysql`, `sqlite`, `postgresql` |
| `server` | string (optional) | No | `null` | Database server hostname (required for mysql/postgresql) _Required for mysql/postgresql engines_ |
| `port` | integer (optional) | No | `null` | Database port (Unit: `port`) _1-65535, defaults: mysql=3306, postgresql=5432_ |
| `database` | string | No | `"homeassistant"` | Database name |
| `username` | string | No | `"homeassistant"` | Database username |
| `password` | string or [SecretStr](#secretstr) (optional) | No | `null` | Database password (can use !secret) _Use !secret for passwords_ |

<details>
<summary><b>üìñ Field Details</b> (click to expand)</summary>

**`engine`**

Database engine where Home Assistant stores history data. Most HA installations use SQLite, but MySQL/MariaDB and PostgreSQL are also supported.

**`server`**

Hostname or IP address of database server. Required for MySQL/PostgreSQL, not used for SQLite. Examples: 'localhost', '192.168.1.100', 'mysql.local'.

**`port`**

Database server port. If not specified, defaults to 3306 for MySQL or 5432 for PostgreSQL. Not used for SQLite.

**`database`**

Name of the Home Assistant database. Default 'homeassistant' matches standard HA installation.

**`username`**

Username for database authentication. Default 'homeassistant' matches standard HA installation.

**`password`**

Database password. Use secrets.json with '!secret password_key' pattern for security. Never store passwords directly in config.

</details>


### HeatingStage

_Single heating stage with power and COP._

Define heat pump performance curve by power stages and corresponding COP values. Multiple stages allow accurate modeling of variable-speed compressors.

| Field | Type | Required | Default | Description |
|-------|------|----------|---------|-------------|
| `max_power` | number | Yes | ‚Äî | Maximum power in watts for this stage (Unit: `W`) _Must be > 0, stages must be sorted ascending_ |
| `cop` | number | Yes | ‚Äî | Coefficient of Performance at this power level (Unit: `ratio`) _Must be > 0, typically 2.5-5.5_ |

<details>
<summary><b>üìñ Field Details</b> (click to expand)</summary>

**`max_power`**

Maximum electrical power consumption for this heating stage in watts. Heat pumps often have multiple stages (e.g., compressor speeds).

**`cop`**

Coefficient of Performance (COP) at this power level. COP = heat_output / electrical_input. Typical values: 3.0-5.0 (3-5x more heat than electricity used).

</details>


### MachineProgram

_Single machine program with power profile._

Define power profile for a machine program. Each program has a name and power consumption pattern over time.

| Field | Type | Required | Default | Description |
|-------|------|----------|---------|-------------|
| `name` | string | Yes | ‚Äî | Program name (e.g., 'eco', 'quick wash', 'off') |
| `power` | list[number] | Yes | ‚Äî | Power consumption in watts for each time interval (Unit: `W`) _List of power values, one per interval (typically 1h each)_ |

<details>
<summary><b>üìñ Field Details</b> (click to expand)</summary>

**`name`**

Descriptive name for this program. Examples: 'eco', 'quick wash', 'intensive', 'off'. Must include an 'off' program with zero power.

**`power`**

Power profile as list of watts per time interval. Length defines program duration. Example: [2000, 2000, 500, 500, 100] for 5-hour wash cycle.

</details>


### SecretStr

_A secret string reference that gets resolved from secrets.json.

Example in options.json:
    {"db_password": "!secret db_password"}
    
Gets resolved to actual value from secrets.json:
    {"db_password": "my_actual_password_123"}_

SecretStr provides secure secret management. Secrets stored in separate secrets.json file, never in main config. Reference format: "!secret key_name". Essential for passwords, API tokens, and sensitive data.

| Field | Type | Required | Default | Description |
|-------|------|----------|---------|-------------|
| `secret_key` | string | Yes | ‚Äî | Secret Key _Use format: !secret key_name_ |

<details>
<summary><b>üìñ Field Details</b> (click to expand)</summary>

**`secret_key`**

Secret key name to resolve from secrets.json. Use '!secret key_name' in config. Never store actual secrets in options.json!

</details>


### SolarString

_Configuration for a single solar panel string._

Configuration for a single string of solar panels with the same tilt and orientation. Use multiple strings for panels facing different directions.

| Field | Type | Required | Default | Description |
|-------|------|----------|---------|-------------|
| `tilt` | number | Yes | ‚Äî | Panel tilt angle in degrees (0=horizontal, 90=vertical) (Unit: `degrees`) _Must be between 0 and 90 degrees_ |
| `orientation` | number | Yes | ‚Äî | Panel orientation in degrees (0=south, 90=west, -90=east) (Unit: `degrees`) _Must be between -180 and 180 degrees_ |
| `capacity` | number | Yes | ‚Äî | Installed capacity in kWp (Unit: `kWp`) _Must be greater than 0_ |
| `yield` | number | Yes | ‚Äî | Yield factor for production calculation (Unit: `ratio`) _Must be greater than 0, typically 0.8-0.9_ |

<details>
<summary><b>üìñ Field Details</b> (click to expand)</summary>

**`tilt`**

Angle of the solar panels relative to horizontal. 0¬∞ = flat/horizontal, 30-35¬∞ = optimal for Netherlands, 90¬∞ = vertical mounting.

**`orientation`**

Compass direction panels are facing. 0¬∞ = south (optimal), 90¬∞ = west, -90¬∞ or 270¬∞ = east, 180¬∞ = north. South-facing panels produce most energy.

**`capacity`**

Peak power capacity of this panel string in kilowatt-peak (kWp). Check panel specifications and sum all panels in this string.

**`yield`**

Efficiency factor for this string. Typically 0.8-0.9. Accounts for inverter losses, cable losses, shading, and dirt on panels.

</details>


---
